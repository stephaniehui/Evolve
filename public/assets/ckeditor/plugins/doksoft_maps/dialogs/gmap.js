function initialize(){var e=(document.getElementById("map-canvas"),CKEDITOR.config.doksoft_maps_width||400),t=CKEDITOR.config.doksoft_maps_height||320,n=new google.maps.LatLng(CKEDITOR.config.doksoft_maps_default_x||-25.363882,CKEDITOR.config.doksoft_maps_default_y||131.044922),a={zoom:CKEDITOR.config.doksoft_maps_default_zoom||4,center:n,disableDefaultUI:!0,disableDoubleClickZoom:!1,draggable:!0,mapTypeControl:!0,zoomControl:!0,rotateControl:!1,scaleControl:!0,streetViewControl:!1,panControl:!1,overviewMapControl:!1,draggableCursor:"move",mapTypeId:google.maps.MapTypeId.ROADMAP};document.getElementById("width").value=e,document.getElementById("height").value=t,document.getElementById("zoom").value=CKEDITOR.config.doksoft_maps_zoom||4,map=new google.maps.Map(document.getElementById("map-canvas"),a),CKEDITOR.config.doksoft_maps_address&&(new google.maps.Geocoder).geocode({address:CKEDITOR.config.doksoft_maps_address},function(e,t){t==google.maps.GeocoderStatus.OK&&(map.setCenter(e[0].geometry.location),CKEDITOR.config.doksoft_maps_default_x=e[0].geometry.location.lan(),CKEDITOR.config.doksoft_maps_default_y=e[0].geometry.location.lng())});var i='<div id="content" style="position:relative; z-index:999;"><label>Text</label><div style="margin:5px;"><textarea id="area1" rows="5" style="width:99%;resize: none;">{text}</textarea></div><div ><input onclick="current_Matker&&current_Matker.setMap(null);delete objects.Marker[objects.Marker.indexOf(current_Matker)]; return false;" style="float:left;" type="button" value="Delete"/><input onclick="current_Matker&&current_Matker.setTitle(document.getElementById(\'area1\').value);infoWindow&&infoWindow.close();return false;" style="float:right;" type="button" value="OK"/><input onclick="infoWindow&&infoWindow.close();return false;" style="float:right;" type="button" value="Cancel"/><div style="clear:both;"></div></div></div>',o='<div id="content" style="position:relative; z-index:999;"><label>Text</label><div style="margin:5px;"><textarea id="area2" rows="5" style="width:99%;resize: none;">{text}</textarea></div><div ><input onclick="current_Matker&&current_Matker.setMap(null);delete objects.Text[objects.Text.indexOf(current_Matker)];  return false;" style="float:left;" type="button" value="Delete"/><input onclick="current_Matker&&current_Matker.set(\'labelContent\',document.getElementById(\'area2\').value);infoWindow&&infoWindow.close();return false;" style="float:right;" type="button" value="OK"/><input onclick="infoWindow&&infoWindow.close();return false;" style="float:right;" type="button" value="Cancel"/><div style="clear:both;"></div></div></div>';infoWindow=new google.maps.InfoWindow,current_Matker=0;var r=function(){var e=this;current_Matker=e,e.getPosition(),infoWindow.setContent(i.replace("{text}",e.getTitle())),infoWindow.open(map,e)},s=function(){var e=this;current_Matker=e,e.getPosition(),infoWindow.setContent(o.replace("{text}",e.get("labelContent"))),infoWindow.open(map,e)};google.maps.event.addListener(map,"click",function(){infoWindow.close()}),markers=[];var l=[document.createElement("div"),document.createElement("div"),document.createElement("div"),document.createElement("div")];for(var d in l)l[d].style.position="absolute",l[d].style.zIndex=99,l[d].style.border="1px solid #BB1111",d%2?(l[d].style.width="1px",l[d].style.height=t+"px",l[d].style.borderWidth="0px 0px 0px 1px"):(l[d].style.height="1px",l[d].style.width=e+"px",l[d].style.borderWidth="1px 0px 0px 0px"),document.getElementById("map-canvas").appendChild(l[d]);$("#map-canvas").append($("#settings_overlay,#layers_overlay"));var c=function(){var n=document.getElementById("map-canvas").offsetWidth,a=document.getElementById("map-canvas").offsetHeight,i=Math.round(n/2-e/2),o=Math.round(a/2-t/2);for(var r in l)switch(parseInt(r)){case 0:l[r].style.top=o+"px",l[r].style.left=i+"px",l[r].style.width=e+"px";break;case 1:l[r].style.top=o+"px",l[r].style.left=i+"px",l[r].style.height=t+"px";break;case 2:l[r].style.top=t+o+"px",l[r].style.left=i+"px",l[r].style.width=e+"px";break;case 3:l[r].style.left=e+i+"px",l[r].style.top=o+"px",l[r].style.height=t+"px"}document.getElementById("width").value=e,document.getElementById("height").value=t};$(window).keyup(function(e){if(46==e.which)if("addpointtocoord"!=mode)deleteObject(currentObject.type,objects[currentObject.type].indexOf(currentObject));else if(currentObject instanceof google.maps.Polyline){var t=currentObject.getPath();t.pop(),t.length?currentObject.setPath(t):(deleteObject(currentObject.type,objects[currentObject.type].indexOf(currentObject)),mode="Polyline")}else mode="";27==e.which&&($(".overlay").fadeOut(500),$("#finish_path,#layers_overlay,#settings_overlay,.dummy").hide(),$("#dialog_box").removeClass("shadow"),mode="",$(".object").removeClass("active"))}),objects={Marker:[],Circle:[],Polyline:[],Text:[],Polygon:[],Rectangle:[],TrafficLayer:[],WeatherLayer:[]},currentObject=0,deleteObject=function(e,t){return t=isNaN(t)?0:t,objects[e].length?(objects[e][t].setMap(null),delete objects[e][t],objects[e].splice(t,1),void 0):0},clickAddObject=function(e,t,n){t=t||{};var a=e.latLng||map.getCenter(),i=Math.pow(2,map.getZoom()),o=map.getProjection().fromLatLngToPoint(a),l=50,d=null,c=map.getProjection().fromPointToLatLng(new google.maps.Point(o.x-l/2/i,o.y-l/2/i)),u=(map.getProjection().fromPointToLatLng(new google.maps.Point(o.x+l/2/i,o.y-l/2/i)),map.getProjection().fromPointToLatLng(new google.maps.Point(o.x+l/2/i,o.y+l/2/i)));switch(map.getProjection().fromPointToLatLng(new google.maps.Point(o.x-l/2/i,o.y+l/2/i)),mode){case"Marker":d=new google.maps.Marker({position:a,map:map,draggable:!0,title:t.text||"Hello World!"}),google.maps.event.addListener(d,"click",r),!n&&r.apply(d);break;case"Rectangle":d=new google.maps.Rectangle({bounds:t.bound||new google.maps.LatLngBounds(c,u),map:map,editable:!0,draggable:!0});break;case"Polyline":case"Polygon":d=new google.maps[mode]({path:t.path||[a],map:map,editable:!0,draggable:!0});break;case"addpointtocoord":if(currentObject instanceof google.maps.Polyline||currentObject instanceof google.maps.Polygon){var p=currentObject.getPath();p.push(a),currentObject.setPath(p)}else mode="";break;case"Text":d=new MarkerWithLabel({position:a,draggable:!0,raiseOnDrag:!0,map:map,labelContent:t.text||"Hello World!",labelAnchor:new google.maps.Point(22,0),labelClass:"labels",labelStyle:{opacity:1,minWidth:"200px",textAlign:"left"},icon:{}}),google.maps.event.addListener(d,"click",s),!n&&s.apply(d);break;case"Circle":d=new google.maps.Circle({radius:t.radius||google.maps.geometry.spherical.computeDistanceBetween(c,u),center:a,map:map,editable:!0,draggable:!0});break;case"WeatherLayer":deleteObject(mode),d=new google.maps.weather.WeatherLayer({temperatureUnits:google.maps.weather.TemperatureUnit.FAHRENHEIT}),d.setMap(map);break;case"TrafficLayer":deleteObject(mode),d=new google.maps.TrafficLayer,d.setMap(map)}d&&"addpointtocoord"!=mode&&(google.maps.event.addListener(d,"click",function(){currentObject=this}),currentObject=d,d.type=mode,objects[d.type].push(d),n||("Polyline"!=mode&&"Polygon"!=mode?($(".object").removeClass("active"),map.setOptions({draggableCursor:"move"}),mode=""):(mode="addpointtocoord",$("#finish_path").show())))},google.maps.event.addListener(map,"click",clickAddObject),$(".object").click(function(){$(".object:not(#"+this.id+")").removeClass("active"),$(this).toggleClass("active"),(mode=$(this).hasClass("active")?this.id:"")?map.setOptions({draggableCursor:"crosshair"}):map.setOptions({draggableCursor:"move"}),$("#finish_path").hide()});var u={hybrid:"roadmap",roadmap:"satellite",satellite:"terrain",terrain:"hybrid"};google.maps.event.addDomListener(document.getElementById("maptype"),"click",function(){map.setMapTypeId(u[map.getMapTypeId()])}),google.maps.event.addDomListener(map,"maptypeid_changed",function(){document.getElementById("maptype_img").src="images/"+map.getMapTypeId()+".png";var e=map.getMapTypeId();document.getElementById("maptype_title").innerHTML=e.charAt(0).toUpperCase()+e.slice(1)}),google.maps.event.addDomListener(map,"zoom_changed",function(){document.getElementById("zoom").value=map.getZoom()}),self.parent.triggerResize=function(e){document.getElementById("map-canvas").style.height=e+"px",c()},google.maps.event.addDomListener(document.getElementById("zoom"),"change",function(){map.setZoom(parseInt(this.value))}),google.maps.event.addDomListener(document.getElementById("zoom"),"keyup",function(){map.setZoom(parseInt(this.value))}),google.maps.event.addDomListener(document.getElementById("width"),"change",function(){e=parseInt(this.value),c()}),google.maps.event.addDomListener(document.getElementById("height"),"change",function(){t=parseInt(this.value),c()}),google.maps.event.addDomListener(document.getElementById("width"),"keyup",function(){e=parseInt(this.value),c()}),google.maps.event.addDomListener(document.getElementById("height"),"keyup",function(){t=parseInt(this.value),c()});var p=document.getElementById("target"),m=new google.maps.places.SearchBox(p);m.bindTo("bounds",map),google.maps.event.addListener(m,"places_changed",function(){if(CKEDITOR.config.doksoft_maps_auto_scaling_on_search===!1)return!0;try{var e=m.getPlaces()[0];e.geometry.viewport?map.fitBounds(e.geometry.viewport):(map.setCenter(e.geometry.location),map.setZoom(17))}catch(t){}}),google.maps.event.addListener(m,"places_changed",function(){var e=m.getPlaces();map.setCenter(e[0].geometry.location)}),self.parent.loadMapFromJSON=function(n){mode="",$("#finish_path,#layers_overlay,#settings_overlay,.dummy").hide(),$("#dialog_box").removeClass("shadow"),$(".object").removeClass("active"),document.getElementById("target").value="",n.width&&(e=n.width),n.height&&(t=n.height),c(),map.setCenter(new google.maps.LatLng(parseFloat(n.lat),parseFloat(n.lng))),map.setZoom(parseInt(n.zoom)),map.setMapTypeId(n.type),$("#settings_overlay .layers").each(function(){map.set(this.id,n.settings[this.id]?!0:!1)});for(var a in objects){for(var i in objects[a])objects[a][i]&&objects[a][i].setMap(null),delete objects[a][i];objects[a]=[]}if(n.objects)for(var a in n.objects)for(var i in n.objects[a]){var o=new google.maps.LatLng(0,0),r={};switch(mode=a,a){case"Marker":o=new google.maps.LatLng(n.objects[a][i][0],n.objects[a][i][1]),r.text=n.objects[a][i][2];break;case"Circle":o=new google.maps.LatLng(n.objects[a][i][0],n.objects[a][i][1]),r.radius=n.objects[a][i][2];break;case"Text":o=new google.maps.LatLng(n.objects[a][i][0],n.objects[a][i][1]),r.text=n.objects[a][i][2];break;case"Rectangle":r.bound=new google.maps.LatLngBounds(new google.maps.LatLng(n.objects[a][i][0][0],n.objects[a][i][0][1]),new google.maps.LatLng(n.objects[a][i][1][0],n.objects[a][i][1][1]));break;case"Polygon":case"Polyline":r.path=[];var s=n.objects[a][i],l=[];for(var d in s)l.push(new google.maps.LatLng(s[d][0],s[d][1]));r.path=l;break;case"Polygon":var s=n.objects[a][i],u=[],l=[];for(var d in s){l=[];for(var p in s[d])l.push(new google.maps.LatLng(s[d][p][0],s[d][p][1]));u.puth(l)}r.paths=u}clickAddObject({latLng:o},r,1)}mode=""},self.parent.generateCodeMap=function(){var n={lat:map.getCenter().lat(),lng:map.getCenter().lng(),zoom:map.getZoom(),type:map.getMapTypeId(),width:e,height:t,settings:{},objects:{Marker:[],Circle:[],Polyline:[],Text:[],Polygon:[],Rectangle:[],TrafficLayer:[],WeatherLayer:[]}};$("#settings_overlay .layers").each(function(){n.settings[this.id]=map.get(this.id)?1:0});for(var a in objects)for(var i in objects[a])if(objects[a][i])switch(a){case"Marker":n.objects[a].push([objects[a][i].getPosition().lat(),objects[a][i].getPosition().lng(),objects[a][i].getTitle()]);break;case"Circle":n.objects[a].push([objects[a][i].getCenter().lat(),objects[a][i].getCenter().lng(),objects[a][i].getRadius()]);break;case"Text":n.objects[a].push([objects[a][i].getPosition().lat(),objects[a][i].getPosition().lng(),objects[a][i].get("labelContent")]);break;case"Rectangle":n.objects[a].push([[objects[a][i].getBounds().getSouthWest().lat(),objects[a][i].getBounds().getSouthWest().lng()],[objects[a][i].getBounds().getNorthEast().lat(),objects[a][i].getBounds().getNorthEast().lng()]]);break;case"Polygon":case"Polyline":var o=objects[a][i].getPath().getArray(),r=[];for(var s in o)r.push([o[s].lat(),o[s].lng()]);n.objects[a].push(r);break;case"Polygon":var o=objects[a][i].getPath().getArray(),l=[],r=[];for(var s in o){r=[];var d=o[s].getArray();for(var c in d)r.push([d[c].lat(),d[c].lng()]);l.push(r)}n.objects[a].push(l);break;case"TrafficLayer":case"WeatherLayer":n.objects[a].push(1)}return n},window.setTimeout(c,500)}CKEDITOR=self.parent.CKEDITOR||{config:{}},self.parent.google=google,mode="",google.maps.event.addDomListener(window,"load",initialize);